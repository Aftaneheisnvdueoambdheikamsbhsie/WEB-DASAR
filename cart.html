<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Keranjang Belanja</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/0.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.3.2/jspdf.min.js"></script>
</head>
<body>

<div id="cart">
    <h1>Keranjang Belanja</h1>
    <table id="cartTable">
        <thead>
            <tr>
                <th>Menu</th>
                <th>Harga</th>
                <th>Aksi</th>
            </tr>
        </thead>
        <tbody id="cartTableBody">
            <!-- Cart items will be populated here -->
        </tbody>
    </table>
    <button id="showNota">Show Nota</button>
</div>

<div id="notaModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closeModal()">&times;</span>
        <h2>Nota Pembayaran</h2>
        <div>
            <p>Nama Pelanggan: <span id="notaCustomer"></span></p>
            <p>No. Telepon: <span id="notaPhone"></span></p>
            <p>Tanggal: <span id="notaOrderDate"></span></p>
            <p>Tipe Order: <span id="notaOrderType"></span></p>
            <p>Kode Transaksi: <span id="notaTransactionCode"></span></p>
            <p>Status Pembayaran: <span id="notaPaymentStatus"></span></p>
            <hr>
            <table id="notaTable">
                <thead>
                    <tr>
                        <th>Jumlah</th>
                        <th>Menu</th>
                        <th>Harga</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Nota items will be populated here -->
                </tbody>
            </table>
            <hr>
            <p>Subtotal: <span id="notaSubTotal"></span></p>
            <p>Pajak: <span id="notaTax"></span></p>
            <p>Rounding: <span id="notaRounding"></span></p>
            <p>Total: <span id="notaTotal"></span></p>
            <div id="qrCodeContainer">
                <h3>QR Code Pembayaran</h3>
                <div id="qrCode"></div>
                <button onclick="downloadQr()">Download QR Code</button>
            </div>
            <button onclick="downloadNota()">Download Nota</button>
        </div>
    </div>
</div>

<script>
    const cart = [
        { item: 'Ayam Penyet', price: 25000 },
        { item: 'Nasi Putih', price: 5000 }
    ];

    function updateCart() {
        const cartTableBody = document.getElementById('cartTableBody');
        cartTableBody.innerHTML = '';

        cart.forEach((item, index) => {
            const row = cartTableBody.insertRow();
            row.insertCell(0).textContent = item.item;
            row.insertCell(1).textContent = 'Rp ' + item.price.toLocaleString();
            const removeCell = row.insertCell(2);
            removeCell.innerHTML = `<button onclick="removeItem(${index})">Hapus</button>`;
        });
    }

    function removeItem(index) {
        cart.splice(index, 1);
        updateCart();
    }

    document.getElementById('showNota').addEventListener('click', () => {
        const customerName = prompt("Masukkan nama pelanggan:");
        const customerPhone = prompt("Masukkan nomor telepon pelanggan:");
        const orderDate = new Date().toLocaleString();
        const orderType = 'Takeaway'; // Example order type
        const transactionCode = Math.floor(Math.random() * 100000); // Random transaction code
        const paymentStatus = 'Belum Dibayar'; // Example payment status

        document.getElementById('notaCustomer').textContent = customerName;
        document.getElementById('notaPhone').textContent = customerPhone;
        document.getElementById('notaOrderDate').textContent = orderDate;
        document.getElementById('notaOrderType').textContent = orderType;
        document.getElementById('notaTransactionCode').textContent = transactionCode;
        document.getElementById('notaPaymentStatus').textContent = paymentStatus;

        // Populate Nota Table
        const notaTableBody = document.getElementById('notaTable').getElementsByTagName('tbody')[0];
        notaTableBody.innerHTML = '';
        let subtotal = 0;

        cart.forEach(item => {
            const row = notaTableBody.insertRow();
            row.insertCell(0).textContent = '1'; // Quantity assumed as 1
            row.insertCell(1).textContent = item.item;
            row.insertCell(2).textContent = 'Rp ' + item.price.toLocaleString();
            subtotal += item.price;
        });

        // Calculate totals
        const tax = subtotal * 0.1; // Example 10% tax
        const rounding = Math.ceil(subtotal + tax);
        const total = subtotal + tax;

        document.getElementById('notaSubTotal').textContent = 'Rp ' + subtotal.toLocaleString();
        document.getElementById('notaTax').textContent = 'Rp ' + tax.toLocaleString();
        document.getElementById('notaRounding').textContent = 'Rp ' + rounding.toLocaleString();
        document.getElementById('notaTotal').textContent = 'Rp ' + total.toLocaleString();

        // Show QR code (replace this with actual QR generation)
        document.getElementById('qrCode').innerHTML = '<img src="https://api.qrserver.com/v1/create-qr-code/?data=' + transactionCode + '" alt="QR Code">';

        // Show the modal
        document.getElementById('notaModal').style.display = 'block';
    });

    // Download Nota as Image
    function downloadNota() {
        const notaContent = document.querySelector('.modal-content');
        html2canvas(notaContent).then(canvas => {
            const link = document.createElement('a');
            link.href = canvas.toDataURL();
            link.download = 'nota.png';
            link.click();
        });

        // Download as PDF
        const doc = new jsPDF();
        doc.html(notaContent, {
            callback: function (doc) {
                doc.save('nota.pdf');
            },
            x: 10,
            y: 10
        });
    }

    // Download QR Code
    function downloadQr() {
        const qrCodeImg = document.getElementById('qrCode').querySelector('img');
        const link = document.createElement('a');
        link.href = qrCodeImg.src;
        link.download = 'qr_code.png';
        link.click();
    }

    // Close Modal Function
    function closeModal() {
        document.getElementById('notaModal').style.display = 'none';
    }

    // Initialize Cart Display
    updateCart();

</script>

<style>
    .modal {
        display: none;
        position: fixed;
        z-index: 1;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        overflow: auto;
        background-color: rgba(0,0,0,0.4);
    }

    .modal-content {
        background-color: #fefefe;
        margin: 15% auto;
        padding: 20px;
        border: 1px solid #888;
        width: 80%;
    }

    .close {
        color: #aaa;
        float: right;
        font-size: 28px;
        font-weight: bold;
    }

    .close:hover,
    .close:focus {
        color: black;
        text-decoration: none;
        cursor: pointer;
    }

    hr {
        margin: 20px 0;
        border: 1px solid #ccc;
    }
</style>

</body>
</html>
